<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 3 Sandwich Estimator | Methods in (Skene &amp; Kenward, 2010)</title>
<meta name="author" content="Dylan Dijk">
<meta name="description" content="3.1 Sandwich Estimator - R Function  The code below gives an R function that returns the estimate of \(\beta\) using the GEE approach (denoted as \(\hat\beta_W\) in paper I) under the setup of a...">
<meta name="generator" content="bookdown 0.27 with bs4_book()">
<meta property="og:title" content="Chapter 3 Sandwich Estimator | Methods in (Skene &amp; Kenward, 2010)">
<meta property="og:type" content="book">
<meta property="og:description" content="3.1 Sandwich Estimator - R Function  The code below gives an R function that returns the estimate of \(\beta\) using the GEE approach (denoted as \(\hat\beta_W\) in paper I) under the setup of a...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 3 Sandwich Estimator | Methods in (Skene &amp; Kenward, 2010)">
<meta name="twitter:description" content="3.1 Sandwich Estimator - R Function  The code below gives an R function that returns the estimate of \(\beta\) using the GEE approach (denoted as \(\hat\beta_W\) in paper I) under the setup of a...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Methods in (Skene &amp; Kenward, 2010)</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Introduction</a></li>
<li class="book-part">SAS</li>
<li><a class="" href="Modified-Box-Correction-SAS.html"><span class="header-section-number">2</span> Modified Box Correction</a></li>
<li class="book-part">R</li>
<li><a class="active" href="Sandwich-Estimator.html"><span class="header-section-number">3</span> Sandwich Estimator</a></li>
<li><a class="" href="Modified-Box-Correction.html"><span class="header-section-number">4</span> Modified Box Correction</a></li>
<li><a class="" href="Scheffe-method.html"><span class="header-section-number">5</span> Scheffé’s method</a></li>
<li><a class="" href="References.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/DylanDijk/Simon-Skene-Mixed-Models-Tutorial">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="Sandwich-Estimator" class="section level1" number="3">
<h1>
<span class="header-section-number">3</span> Sandwich Estimator<a class="anchor" aria-label="anchor" href="#Sandwich-Estimator"><i class="fas fa-link"></i></a>
</h1>
<div id="sandwich-estimator---r-function" class="section level2" number="3.1">
<h2>
<span class="header-section-number">3.1</span> Sandwich Estimator - R Function<a class="anchor" aria-label="anchor" href="#sandwich-estimator---r-function"><i class="fas fa-link"></i></a>
</h2>
<!-- The sandwich estimator unlike the modified Box correction does not use a REML estimate. Therefore we do not need to use a package for mixed models such as **lme4** or **nlme**. -->
<p>The code below gives an R function that returns the estimate of <span class="math inline">\(\beta\)</span> using the GEE approach (denoted as <span class="math inline">\(\hat\beta_W\)</span> in paper I) under the setup of a multivariate linear model as described by equation <a href="index.html#eq:general-model">(1.1)</a>. The function also returns the sandwich estimator for the covariance matrix of the estimate of <span class="math inline">\(\beta\)</span>.</p>
<p>To use this function you need to copy the code (can click on clipboard symbol on top right corner of code chunk) and run it in R so that it is in your R environment. How to use this function is then illustrated by an example.</p>
<p>This <code>sandwich_estimator()</code> function takes four inputs: <code>model</code>, <code>subjects</code>, <code>data</code> and <code>W</code>. The <code>model</code> is used to describe the mean model and takes the same form as you would give a formula in <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>. The <code>subjects</code> variable is used to identify the variable in the data that labels the subjects. <code>W</code> is then used to set the working covariance matrix. In paper II the working covariance matrix is denoted as (<span class="math inline">\(W^{-1}\)</span>).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://Matrix.R-forge.R-project.org/">Matrix</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">sandwich_estimator</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">subjects</span>, <span class="va">data</span>, <span class="va">W</span> <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">model_formula</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">model_formula</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span>  <span class="va">full_model_frame</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.frame.html">model.frame</a></span><span class="op">(</span><span class="va">model_formula</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span>  <span class="va">Y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.extract.html">model.response</a></span><span class="op">(</span><span class="va">full_model_frame</span><span class="op">)</span></span>
<span>  </span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">W</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fl">1</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span>  </span>
<span><span class="va">beta_W</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="va">X</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="va">Y</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="va">sigma_i_comb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">subjects</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">Y_i</span> <span class="op">=</span> <span class="va">Y</span><span class="op">[</span><span class="va">data</span><span class="op">[[</span><span class="va">subjects</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="va">i</span><span class="op">]</span></span>
<span>    <span class="va">X_i</span> <span class="op">=</span> <span class="va">X</span><span class="op">[</span><span class="va">data</span><span class="op">[[</span><span class="va">subjects</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="va">i</span>,<span class="op">]</span></span>
<span>    <span class="va">sigma_i</span> <span class="op">=</span> <span class="op">(</span><span class="va">Y_i</span> <span class="op">-</span> <span class="op">(</span><span class="va">X_i</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">beta_W</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">sigma_i</span> <span class="op">=</span> <span class="va">sigma_i</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">sigma_i</span> <span class="op">=</span> <span class="va">sigma_i</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">sigma_i</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">sigma_i_comb</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">sigma_i</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">sigma</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/bdiag.html">bdiag</a></span><span class="op">(</span><span class="va">sigma_i_comb</span><span class="op">)</span></span>
<span>  <span class="va">V_s</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="va">X</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="va">sigma</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="va">X</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"beta_W"</span> <span class="op">=</span> <span class="va">beta_W</span>, <span class="st">"V_s"</span> <span class="op">=</span> <span class="va">V_s</span>, <span class="st">"sigma_i_comb"</span> <span class="op">=</span> <span class="va">sigma_i_comb</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div id="wald-test-using-sandwich-estimator---r-function" class="section level2" number="3.2">
<h2>
<span class="header-section-number">3.2</span> Wald Test using Sandwich Estimator - R Function<a class="anchor" aria-label="anchor" href="#wald-test-using-sandwich-estimator---r-function"><i class="fas fa-link"></i></a>
</h2>
<p>This <code>sandwich_estimator_p_value()</code> function carries out a Wald test using the sandwich estimate outputted from the <code>sandwich_estimator()</code> function, therefore both functions need to be in your R environment.</p>
<p>This function has an additional <code>model_r</code> variable, and you should assign to it a formula with the variables removed that you want to test for significance for in the full model defined in the <code>model</code> variable.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sandwich_estimator_p_value</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">model_r</span>, <span class="va">subjects</span>, <span class="va">data</span>, <span class="va">W</span> <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">sand_estimate</span> <span class="op">=</span> <span class="fu">sandwich_estimator</span><span class="op">(</span>model <span class="op">=</span> <span class="va">model</span>, subjects <span class="op">=</span> <span class="va">subjects</span>, data <span class="op">=</span> <span class="va">data</span>, W <span class="op">=</span> <span class="va">W</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">Beta_r_names</span> <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">model</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">model</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">model_r</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">Beta_r</span> <span class="op">=</span> <span class="va">sand_estimate</span><span class="op">$</span><span class="va">beta_W</span><span class="op">[</span><span class="va">Beta_r_names</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">Wald_sand_stat</span> <span class="op">=</span> <span class="op">(</span><span class="va">Beta_r</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="va">sand_estimate</span><span class="op">$</span><span class="va">V_s</span><span class="op">[</span><span class="va">Beta_r_names</span>,<span class="va">Beta_r_names</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">Beta_r</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">Wald_sand_stat_p_value</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">pchisq</a></span><span class="op">(</span>q <span class="op">=</span> <span class="va">Wald_sand_stat</span>, df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">Beta_r</span><span class="op">)</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"Wald_sand_stat"</span> <span class="op">=</span> <span class="va">Wald_sand_stat</span>, <span class="st">"Wald_sand_stat_p_value"</span> <span class="op">=</span> <span class="va">Wald_sand_stat_p_value</span>, <span class="st">"Beta_r"</span> <span class="op">=</span> <span class="va">Beta_r</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<hr>
<div id="Sandwich-Cardiac-Enzyme-Example" class="section level3" number="3.2.1">
<h3>
<span class="header-section-number">3.2.1</span> Example - Cardiac Enzyme Dataset<a class="anchor" aria-label="anchor" href="#Sandwich-Cardiac-Enzyme-Example"><i class="fas fa-link"></i></a>
</h3>
<p>In this example we look at the same dataset and mean model that was used in the example covered in Section 6.1 of paper II. We apply the <code>sandwich_estimator()</code> function to output the sandwich estimator of the covariance matrix of the estimated fixed effects. Then use the <code>sandwich_estimator_p_value()</code> to test for the inclusion of the interaction term between treatment and time in the model.</p>
<p>First of all we need to import the dataset. The code below imports the dataset from a GitHub repository, and converts a selection of the variables in the dataset to factors.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Cardiac_enzyme_data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/DylanDijk/Simon-Skene-Mixed-Models-Tutorial/main/Data_Images_Figures/The%20Cardiac%20Enzyme%20Data%20-%20Reduced%20Data%20set.csv"</span><span class="op">)</span></span>
<span><span class="va">Cardiac_enzyme_data</span><span class="op">$</span><span class="va">dog</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">Cardiac_enzyme_data</span><span class="op">$</span><span class="va">dog</span><span class="op">)</span></span>
<span><span class="va">Cardiac_enzyme_data</span><span class="op">$</span><span class="va">trt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">Cardiac_enzyme_data</span><span class="op">$</span><span class="va">trt</span><span class="op">)</span></span>
<span><span class="va">Cardiac_enzyme_data</span><span class="op">$</span><span class="va">time</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">Cardiac_enzyme_data</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></span></code></pre></div>
<p>The code below runs the <code>sandwich_estimator</code> function:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Cardiac_enzyme_sandwich_estimate</span> <span class="op">=</span> </span>
<span>  <span class="fu">sandwich_estimator</span><span class="op">(</span>model <span class="op">=</span> <span class="va">atp</span> <span class="op">~</span>  <span class="va">trt</span> <span class="op">+</span> <span class="va">time</span> <span class="op">+</span> <span class="va">trt</span><span class="op">:</span><span class="va">time</span>,</span>
<span>                     subjects <span class="op">=</span> <span class="st">"dog"</span>, data <span class="op">=</span> <span class="va">Cardiac_enzyme_data</span><span class="op">)</span></span></code></pre></div>
<p>After running this function we can then extract the estimate of <span class="math inline">\(\beta\)</span> (<code>beta_W</code>) and the sandwich estimate of <span class="math inline">\(\Sigma\)</span> (<code>V_s</code>).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Cardiac_enzyme_sandwich_estimate</span><span class="op">$</span><span class="va">beta_W</span></span>
<span><span class="va">Cardiac_enzyme_sandwich_estimate</span><span class="op">$</span><span class="va">V_s</span></span></code></pre></div>
<p>The code below runs the <code>sandwich_estimator_p_value()</code> function:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Cardiac_enzyme_sandwich_wald_p_value</span> <span class="op">=</span> </span>
<span><span class="fu">sandwich_estimator_p_value</span><span class="op">(</span>model <span class="op">=</span> <span class="va">atp</span> <span class="op">~</span> <span class="va">trt</span> <span class="op">+</span> <span class="va">time</span> <span class="op">+</span> <span class="va">trt</span><span class="op">:</span><span class="va">time</span>,</span>
<span>                           model_r <span class="op">=</span> <span class="va">atp</span> <span class="op">~</span> <span class="va">trt</span> <span class="op">+</span> <span class="va">time</span>, </span>
<span>                           data <span class="op">=</span> <span class="va">Cardiac_enzyme_data</span>, subjects <span class="op">=</span> <span class="st">"dog"</span><span class="op">)</span></span></code></pre></div>
<p>And we get the following p-value:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="Sandwich-Estimator.html#cb11-1" aria-hidden="true" tabindex="-1"></a>Cardiac_enzyme_sandwich_wald_p_value<span class="sc">$</span>Wald_sand_stat_p_value</span>
<span id="cb11-2"><a href="Sandwich-Estimator.html#cb11-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">1.02213e-55</span></span></code></pre></div>
<hr>
</div>
</div>
<div id="adjusted-sandwich-estimator" class="section level2" number="3.3">
<h2>
<span class="header-section-number">3.3</span> Adjusted Sandwich Estimator<a class="anchor" aria-label="anchor" href="#adjusted-sandwich-estimator"><i class="fas fa-link"></i></a>
</h2>
<p>The <code>adj_sandwich_estimator()</code> function below computes the Wald <span class="math inline">\(F\)</span>-statistic as described in Section 3 of paper I. The function uses the sandwich estimator computed by the <code>sandwich_estimator()</code> function and therefore requires both of the previous functions to be in your R environment.</p>
<p>This function has the same input variables as the <code>adj_sandwich_estimator_p_value()</code> function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adj_sandwich_estimator</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">model_r</span>, <span class="va">subjects</span>, <span class="va">data</span>, <span class="va">W</span> <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">sand_estimate</span> <span class="op">=</span> <span class="fu">sandwich_estimator</span><span class="op">(</span>model <span class="op">=</span> <span class="va">model</span>, subjects <span class="op">=</span> <span class="va">subjects</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">sand_stat</span> <span class="op">=</span> <span class="fu">sandwich_estimator_p_value</span><span class="op">(</span>model <span class="op">=</span> <span class="va">model</span>, model_r <span class="op">=</span> <span class="va">model_r</span>, subjects <span class="op">=</span> <span class="va">subjects</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">l</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sand_stat</span><span class="op">$</span><span class="va">Beta_r</span><span class="op">)</span></span>
<span></span>
<span><span class="va">K</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>length <span class="op">=</span> <span class="va">l</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">l</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>          <span class="va">vec</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">l</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="op">(</span><span class="va">l</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>    </span>
<span>      <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">l</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">{</span></span>
<span>      </span>
<span>        <span class="kw">if</span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">j</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="op">(</span><span class="va">l</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>          <span class="va">vec</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span></span>
<span>          </span>
<span>        <span class="op">}</span></span>
<span>      <span class="op">}</span>  </span>
<span>    <span class="op">}</span></span>
<span></span>
<span>     <span class="va">K</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span>  <span class="va">vec</span>     </span>
<span>          </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">Beta_r_names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">sand_stat</span><span class="op">$</span><span class="va">Beta_r</span><span class="op">)</span></span>
<span></span>
<span><span class="va">K</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">K</span><span class="op">)</span></span>
<span><span class="va">omega_hat</span> <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">l</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">K</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> </span>
<span>  <span class="op">(</span><span class="va">sand_estimate</span><span class="op">$</span><span class="va">V_s</span><span class="op">[</span><span class="va">Beta_r_names</span>, <span class="va">Beta_r_names</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/kronecker.html">%x%</a></span></span>
<span>    <span class="va">sand_estimate</span><span class="op">$</span><span class="va">V_s</span><span class="op">[</span><span class="va">Beta_r_names</span>, <span class="va">Beta_r_names</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">model</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="va">W</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fl">1</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">mod_based_est</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">X</span><span class="op">)</span></span>
<span></span>
<span><span class="va">P_i</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span> <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">subjects</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">X_i</span> <span class="op">=</span> <span class="va">X</span><span class="op">[</span><span class="va">data</span><span class="op">[[</span><span class="va">subjects</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="va">i</span>,<span class="op">]</span></span>
<span>    <span class="va">P_i</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">X_i</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">W</span><span class="op">[</span><span class="va">data</span><span class="op">[[</span><span class="va">subjects</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="va">i</span>,<span class="va">data</span><span class="op">[[</span><span class="va">subjects</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="va">i</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">sand_estimate</span><span class="op">$</span><span class="va">sigma_i_comb</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span></span>
<span>    <span class="va">W</span><span class="op">[</span><span class="va">data</span><span class="op">[[</span><span class="va">subjects</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="va">i</span>,<span class="va">data</span><span class="op">[[</span><span class="va">subjects</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="va">i</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">X_i</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">P_hat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Reduce</a></span><span class="op">(</span><span class="st">"+"</span>, <span class="va">P_i</span><span class="op">)</span><span class="op">/</span><span class="va">n</span></span>
<span></span>
<span><span class="va">P_i_minus_P_hat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">P_i</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span> <span class="op">-</span> <span class="va">P_hat</span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">T_hat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Reduce</a></span><span class="op">(</span><span class="st">"+"</span>,<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">P_i_minus_P_hat</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">psi_hat</span> <span class="op">=</span> <span class="va">n</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">mod_based_est</span><span class="op">[</span><span class="va">Beta_r_names</span>,<span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/kronecker.html">%x%</a></span> <span class="va">mod_based_est</span><span class="op">[</span><span class="va">Beta_r_names</span>,<span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span></span>
<span>             <span class="va">T_hat</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">mod_based_est</span><span class="op">[</span><span class="va">Beta_r_names</span>,<span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/kronecker.html">%x%</a></span> <span class="va">mod_based_est</span><span class="op">[</span><span class="va">Beta_r_names</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">v</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">psi_hat</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">omega_hat</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">psi_hat</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">psi_hat</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">F_Wald_adj_sand</span> <span class="op">=</span> <span class="op">(</span><span class="va">v</span> <span class="op">-</span> <span class="va">l</span> <span class="op">+</span> <span class="va">l</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">v</span> <span class="op">*</span> <span class="va">l</span><span class="op">)</span> <span class="op">*</span> <span class="va">sand_stat</span><span class="op">$</span><span class="va">Wald_sand_stat</span></span>
<span>  </span>
<span><span class="va">F_Wald_adj_sand_p</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Fdist.html">pf</a></span><span class="op">(</span>df1 <span class="op">=</span> <span class="va">l</span>, df2 <span class="op">=</span> <span class="va">v</span> <span class="op">-</span> <span class="va">l</span> <span class="op">+</span><span class="fl">1</span>, q <span class="op">=</span> <span class="va">F_Wald_adj_sand</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"F_Wald_adj_sand"</span> <span class="op">=</span> <span class="va">F_Wald_adj_sand</span>,</span>
<span>            <span class="st">"F_Wald_adj_sand_p"</span> <span class="op">=</span> <span class="va">F_Wald_adj_sand_p</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
<div id="example-1" class="section level3" number="3.3.1">
<h3>
<span class="header-section-number">3.3.1</span> Example<a class="anchor" aria-label="anchor" href="#example-1"><i class="fas fa-link"></i></a>
</h3>
<p>This example is analogue to the calculation of the p-value in subsection <a href="Sandwich-Estimator.html#Sandwich-Cardiac-Enzyme-Example">3.2.1</a>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Cardiac_enzyme_adj_sandwich_wald_p_value</span> <span class="op">=</span> </span>
<span><span class="fu">adj_sandwich_estimator</span><span class="op">(</span>model <span class="op">=</span> <span class="va">atp</span> <span class="op">~</span> <span class="va">trt</span> <span class="op">+</span> <span class="va">time</span> <span class="op">+</span> <span class="va">trt</span><span class="op">:</span><span class="va">time</span>,</span>
<span>                           model_r <span class="op">=</span> <span class="va">atp</span> <span class="op">~</span> <span class="va">trt</span> <span class="op">+</span> <span class="va">time</span>, </span>
<span>                           data <span class="op">=</span> <span class="va">Cardiac_enzyme_data</span>, subjects <span class="op">=</span> <span class="st">"dog"</span><span class="op">)</span></span></code></pre></div>
<p>We get the following Wald <span class="math inline">\(F\)</span>-statistic and p-value:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="Sandwich-Estimator.html#cb14-1" aria-hidden="true" tabindex="-1"></a>Cardiac_enzyme_adj_sandwich_wald_p_value<span class="sc">$</span>F_Wald_adj_sand</span>
<span id="cb14-2"><a href="Sandwich-Estimator.html#cb14-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">34.91697</span></span>
<span id="cb14-3"><a href="Sandwich-Estimator.html#cb14-3" aria-hidden="true" tabindex="-1"></a>Cardiac_enzyme_adj_sandwich_wald_p_value<span class="sc">$</span>F_Wald_adj_sand_p</span>
<span id="cb14-4"><a href="Sandwich-Estimator.html#cb14-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.1325053</span></span></code></pre></div>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="Modified-Box-Correction-SAS.html"><span class="header-section-number">2</span> Modified Box Correction</a></div>
<div class="next"><a href="Modified-Box-Correction.html"><span class="header-section-number">4</span> Modified Box Correction</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#Sandwich-Estimator"><span class="header-section-number">3</span> Sandwich Estimator</a></li>
<li><a class="nav-link" href="#sandwich-estimator---r-function"><span class="header-section-number">3.1</span> Sandwich Estimator - R Function</a></li>
<li>
<a class="nav-link" href="#wald-test-using-sandwich-estimator---r-function"><span class="header-section-number">3.2</span> Wald Test using Sandwich Estimator - R Function</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#Sandwich-Cardiac-Enzyme-Example"><span class="header-section-number">3.2.1</span> Example - Cardiac Enzyme Dataset</a></li></ul>
</li>
<li>
<a class="nav-link" href="#adjusted-sandwich-estimator"><span class="header-section-number">3.3</span> Adjusted Sandwich Estimator</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#example-1"><span class="header-section-number">3.3.1</span> Example</a></li></ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/DylanDijk/Simon-Skene-Mixed-Models-Tutorial/blob/main/02-sandwhich_R.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/DylanDijk/Simon-Skene-Mixed-Models-Tutorial/edit/main/02-sandwhich_R.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Methods in (Skene &amp; Kenward, 2010)</strong>" was written by Dylan Dijk. It was last built on 2022-09-09.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
